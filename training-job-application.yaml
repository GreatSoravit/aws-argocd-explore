apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: training-job
  namespace: argocd
spec:
  project: default

  source:
    # GitOps repository.
    repoURL: 'https://github.com/GreatSoravit/aws-argocd-explore.git'
    
    # This is the branch Argo CD should watch. 'HEAD' means the default branch (usually 'main').
    targetRevision: HEAD
    
    # The folder inside your GitOps repo where your Kubernetes manifests are located.
    path: jobs

  # This section tells Argo CD WHERE to deploy your application (the destination).
  destination:
    server: 'https://kubernetes.default.svc'
    # Deploy the jobs into a dedicated namespace
    namespace: ml-jobs

  syncPolicy:
    automated:
      # This tells Argo CD to delete resources that are removed from Git.
      prune: true
      # This tells Argo CD to automatically fix any manual changes made to the cluster.
      selfHeal: true
    
    # These options are useful for managing jobs and namespaces
    syncOptions:
    # delete this specific type of resource last, after everything else is gone.
    - PruneLast=true